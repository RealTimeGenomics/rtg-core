/*
 * Copyright (c) 2014. Real Time Genomics Limited.
 *
 * Use of this source code is bound by the Real Time Genomics Limited Software Licence Agreement
 * for Academic Non-commercial Research Purposes only.
 *
 * If you did not receive a license accompanying this file, a copy must first be obtained by email
 * from support@realtimegenomics.com.  On downloading, using and/or continuing to use this source
 * code you accept the terms of that license agreement and any amendments to those terms that may
 * be made from time to time by Real Time Genomics Limited.
 */

package com.rtg.variant.realign;

import static com.rtg.util.StringUtils.LS;

import com.rtg.mode.DnaUtils;
import com.rtg.util.integrity.Exam;
import com.rtg.variant.util.arithmetic.LogApproximatePossibility;
import com.rtg.variant.util.arithmetic.LogPossibility;
import com.rtg.variant.util.arithmetic.PossibilityArithmetic;
import com.rtg.variant.util.arithmetic.SimplePossibility;

import junit.framework.Test;
import junit.framework.TestSuite;


/**
 */
public abstract class ScoreMatrixCGReverseTest extends ScoreMatrixCGTest {

  //Mark says I have to put my name here so he doesnt get blamed for the next bit of code
  //JC

  /** Used for testing. */
  public static class LogTest extends ScoreMatrixCGReverseTest {
    public LogTest() { }
    @Override
    protected AllPaths score(final Environment env) {
      return score(LogPossibility.SINGLETON, env);
    }
  }

  /** Used for testing. */
  public static class LogApproximateTest extends ScoreMatrixCGReverseTest {
    public LogApproximateTest() { }
    @Override
    protected AllPaths score(final Environment env) {
      return score(LogApproximatePossibility.SINGLETON, env);
    }
    @Override
    public void testToString() { }
  }

  /** Used for testing. */
  public static class SimpleTest extends ScoreMatrixCGReverseTest {
    public SimpleTest() { }
    @Override
    protected AllPaths score(final Environment env) {
      return score(SimplePossibility.SINGLETON, env);
    }
  }

  public static Test suite() {
    final TestSuite suite = new TestSuite("com.rtg.variant.realign");
    suite.addTestSuite(LogApproximateTest.class);
    suite.addTestSuite(LogTest.class);
    suite.addTestSuite(SimpleTest.class);
    return suite;
  }

  @Override
  protected byte[] read() {
    return DnaUtils.encodeString(ScoreMatrixCGTest.READ);
  }

  @Override
  protected byte[] template() {
    return DnaUtils.encodeString(ScoreMatrixCGTest.TEMPLATE);
  }

  @Override
  protected AllPaths score(final PossibilityArithmetic arith, final Environment env) {
    final AllPaths score = new ScoreMatrixCGReverse(arith, new MockRealignParamsCG());
    score.setEnv(env);
    Exam.globalIntegrity(score);
    return score;
  }

  @Override
  public void testRowOffset() {
    final AllPaths score0 = score(env());
    if (score0 instanceof ScoreMatrixCG) {
      final ScoreMatrixCG score = (ScoreMatrixCG) score0;
      final int half = -8; // half of the width of the band (at row 1).
      assertEquals(half, score.rowOffset(0));
      assertEquals(half + 5, score.rowOffset(5));
      assertEquals(half + 6 - 2, score.rowOffset(6));
      assertEquals(half + 25 - 2, score.rowOffset(25));
      assertEquals(half + 26 - 2 + 6, score.rowOffset(26));
    }
  }

  @Override
  public void testStartScores() {
    final Environment mEnv = env();
    final AllPaths score0 = score(mEnv);
    if (score0 instanceof ScoreMatrixCG) {
      final ScoreMatrixCG score = (ScoreMatrixCG) score0;
      final int maxShift = mEnv.maxShift();
      final int w = 2 * maxShift + 1;  // width
      assertEquals(w, score.mWidth);
      final int last = score.mLength;
      for (int col = 0; col < w; col++) {
        assertEquals(0.0, score.arithmetic().poss2Ln(score.delete(last, col)));
        assertEquals(0.0, score.arithmetic().poss2Ln(score.match(last, col)));
        assertEquals(Double.NEGATIVE_INFINITY, score.arithmetic().poss2Ln(score.insert(last, col)));
      }
    }
  }

  @Override
  public void testTotalScoreLn() {
    final AllPaths score = score(env());
    assertEquals(-10.012458, score.totalScoreLn(), 0.0002);
    assertEquals(-10.012458, Math.log(score.totalScore()), 0.0002);
  }

  @Override
  public void testScoreLn() {
    final Environment mEnv = env();
    final AllPaths score0 = score(mEnv);
    if (score0 instanceof ScoreMatrixCG) {
      final ScoreMatrixCG score = (ScoreMatrixCG) score0;
      final int maxShift = mEnv.maxShift();
      assertEquals(-maxShift, score.rowOffset(1));
      final int start = mEnv.absoluteTemplatePosition(0);
      // down column 8 (first T on the template), cuts through the overlap region
      final int tPos = 8 - start;
      checkScores(score, 0, tPos, -12.6462, -12.4498, Double.NEGATIVE_INFINITY);
      checkScores(score, 1, tPos, -16.8551, -16.9501, -13.0428);
      checkScores(score, 2, tPos, -14.7730, -14.4005, -10.3354);
      checkScores(score, 3, tPos, -16.5896, -16.1711, -11.9198);
      checkScores(score, 4, tPos, -19.0452, -18.3808, -13.5117);
      checkScores(score, 5, tPos, -21.3363, -20.4260, -15.0958);
      checkScores(score, 6, tPos, -19.7458, -18.8543, -13.7007);
      checkScores(score, 7, tPos, -26.3596, -21.1361, -15.2996);
      checkScores(score, 8, tPos, -27.9488, -22.7212, -16.8846);
      checkScores(score, 9, tPos, -29.5036, -24.3107, -18.4742);
      checkScores(score, 10, tPos, -29.8945, -25.8869, -20.0569);
      checkScores(score, 11, tPos, -27.6707, -26.7838, -21.6349);
    }
  }

  @Override
  public void testToString() {
    final AllPaths score = score(env());
    assertEquals(""
        + "ScoreMatrix                |G            0       |G            1       |G            2       |G            3       |G            4       |G            5       |G            6       |A            7       |T            8       |A            9       |A           10       |A           11       |A           12       |A           13       |A           14       |G           15       |G           16       |C           17       |G           18       |A           19       |C           20       |A           21       |T           22       |G           23       |C           24       |C           25       |A           26       |A           27       |T           28       |G           29       |T           30       |G           31       |T           32       |C           33       |G           34       |C           35       |C           36       |T           37       |T           38       |T           39       |T           40       |T           41       |C           42       |A           43       |A           44       |C           45       |T           46       |T           47       |T           48       |C           49       |C           50       |G           51       |A           52       |T           53       |" + LS
        + "[  0]         33.984 34.181|        32.375 32.491|        30.766 30.882|        29.157 29.273|        27.546 27.662|        25.649 25.784|        24.323 24.365|        14.559 14.756|        20.221 17.680|        12.450 12.646|        10.131 10.323|        14.389 12.842|        16.808 12.097|        19.882 15.155|        22.863 18.231|" + LS
        + "[  1]A                     | 25.223 30.656 31.942| 23.614 29.048 30.328| 22.006 27.439 28.718| 20.398 25.830 27.109| 18.790 24.220 25.493| 17.181 22.322 23.196| 15.574 20.997 21.751| 13.966 14.442 14.642| 13.043 16.950 16.855| 11.447 12.333 12.511| 10.237 10.014  9.930| 16.974 14.290  8.999| 21.145 17.406 12.057| 24.810 20.497 15.134| 27.200 23.384 18.032|" + LS
        + "[  2]T                     |                     | 21.599 27.435 32.668| 19.990 25.826 31.049| 18.380 24.217 29.440| 16.771 22.607 27.822| 15.161 20.991 25.532| 13.552 18.694 19.565| 11.945 17.756 21.423| 10.335 14.401 14.773|  8.738 12.797 13.168|  7.140  8.028  8.230|  5.928  5.706  5.899| 12.826 12.446  8.956| 17.440 16.620 12.033| 24.850 20.297 14.931| 32.580 22.669 17.290|" + LS
        + "[  3]A                     |                     |                     | 21.574 27.411 32.649| 19.965 25.801 31.031| 18.355 24.192 29.421| 16.746 22.574 26.980| 15.136 20.285 21.160| 13.529 19.355 23.630| 11.920 16.171 16.590| 10.319 14.561 14.974|  8.719 12.956 13.368|  7.119  8.011  8.213|  5.905  5.684  5.877| 12.997 12.584  8.937| 21.736 17.196 11.830| 28.874 19.568 14.189| 32.206 27.299 21.928|" + LS
        + "[  4]A                     |                     |                     |                     | 21.556 27.392 32.626| 19.946 25.783 31.006| 18.337 24.173 29.394| 16.727 21.727 22.485| 15.121 20.953 25.392| 13.512 18.381 19.045| 11.906 16.374 16.858| 10.304 14.762 15.238|  8.701 13.156 13.630|  7.099  7.994  8.195|  5.883  5.662  5.853| 13.269 12.753  8.729| 21.006 16.454 11.088| 24.595 23.599 18.827| 27.683 26.924 22.418|" + LS
        + "[  5]A                     |                     |                     |                     |                     | 21.533 27.369 32.416| 19.923 25.760 30.800| 18.314 24.149 28.924| 16.704 22.266 23.667| 15.096 20.426 21.336| 13.488 18.831 19.760| 11.880 16.642 17.053| 10.275 15.026 15.432|  8.670 13.418 13.822|  7.066  7.976  7.981|  5.843  5.640  5.639|  8.211  7.988  7.987| 16.852 15.730 15.729| 24.569 19.322 19.322| 27.657 22.401 22.401|" + LS
        + "[  6]A                     |                     |                     |                     | 21.746 27.570 31.735| 20.136 25.966 29.647| 18.527 24.363 28.722| 16.917 22.072 22.965| 15.310 21.147 26.384| 13.701 18.854 19.746| 12.094 17.246 18.136| 10.486 15.638 16.527|  8.879 14.029 14.917|  7.272 12.418 13.302|  5.665  5.443  5.640| 18.657 14.086  8.719| 22.406 17.167 11.795| 24.810 20.244 14.877| 28.589 23.322 17.949|" + LS
        + "[  7]A                     |                     |                     |                     |                     | 21.730 26.478 27.080| 20.126 25.273 26.150| 18.518 24.355 29.578| 16.909 22.746 27.969| 15.300 21.136 26.360| 13.690 19.527 24.750| 12.081 17.917 23.141| 10.471 16.308 21.531|  8.862 14.698 19.922|  7.252 13.083 17.629|  5.643  5.421  5.618| 14.292 13.380  8.694| 21.179 17.143 11.776| 20.443 19.533 14.848| 28.563 23.307 17.934|" + LS
        + "[  8]G                     |                     |                     |                     |                     |                     | 21.711 26.861 27.749| 20.103 25.940 31.168| 18.494 24.331 29.558| 16.885 22.721 27.949| 15.275 21.112 26.339| 13.666 19.502 24.730| 12.056 17.893 23.121| 10.447 16.283 21.505|  8.838 14.674 19.887|  7.228 12.377 13.264|  5.621  5.399  5.596| 18.425 14.048  8.675| 17.349 16.437 11.750| 24.768 20.200 14.833| 28.538 23.281 17.908|" + LS
        + "[  9]G                     |                     |                     |                     |                     |                     |                     | 21.693 27.530 32.753| 20.084 25.920 31.126| 18.474 24.311 29.504| 16.865 22.701 27.894| 15.255 21.092 26.285| 13.646 19.482 24.676| 12.037 17.873 23.073| 10.427 16.257 20.793|  8.818 14.648 18.659|  7.208 13.045 17.396|  5.599  5.377  5.574| 19.263 14.026  8.653| 21.475 17.105 11.732| 20.399 19.491 14.807| 28.399 23.256 17.884|" + LS
        + "[ 10]C                     |                     |                     |                     |                     |                     |                     |                     | 21.666 27.496 32.041| 20.057 25.887 29.894| 18.447 24.278 28.285| 16.838 22.668 26.677| 15.229 21.059 25.071| 13.619 19.449 23.466| 12.010 17.846 22.201| 10.400 15.547 16.432|  8.793 13.942 14.828|  7.186 13.023 18.233|  5.577  5.355  5.552| 19.244 14.004  8.631| 21.583 17.076 11.710| 25.288 20.155 14.783| 28.310 23.117 17.745|" + LS
        + "[ 11]G                     |                     |                     |                     |                     |                     |                     |                     |                     | 21.635 26.784 27.671| 20.028 25.175 26.060| 18.421 23.567 24.451| 16.814 21.959 22.842| 15.207 20.355 21.241| 13.599 18.747 19.632| 11.992 17.829 23.051| 10.383 16.213 20.729|  8.774 14.609 18.862|  7.164 13.001 18.015|  5.555  5.333  5.530| 18.283 13.982  8.609| 17.159 16.306 11.682| 25.209 20.016 14.644| 33.045 23.028 17.649|" + LS
        + "[ 12]A                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 21.624 27.452 31.827| 20.014 25.841 29.607| 18.405 24.232 27.963| 16.796 22.623 26.383| 15.186 21.022 25.173| 13.577 19.413 24.574| 11.967 17.804 22.967| 10.358 15.477 16.335|  8.751 14.435 16.544|  7.142 12.976 14.591|  5.533  5.311  5.508| 19.086 13.957  8.585| 22.108 16.915 11.543| 29.746 19.927 14.548| 28.672 27.763 23.079|" + LS
        + "[ 13]C                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 21.534 26.570 27.355| 19.928 24.908 25.649| 18.321 23.312 24.060| 16.715 21.741 22.514| 15.109 20.943 25.528| 13.499 19.334 24.066| 11.890 17.725 22.510| 10.280 16.116 21.016|  8.671 11.288 11.523|  7.119 12.763 13.965|  5.511  5.289  5.484| 19.001 13.814  8.441| 26.661 16.826 11.447| 29.744 25.346 19.982| 32.890 28.428 23.063|" + LS
        + "[ 14]A                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 21.455 27.136 29.235| 19.845 25.432 26.847| 18.237 23.844 24.859| 16.628 22.299 23.507| 15.019 20.686 22.256| 13.410 19.130 20.836| 11.801 17.527 19.834| 10.192 15.918 18.307|  8.582 11.304 11.544|  7.025  9.415  8.817|  5.489  5.267  5.340| 19.057 13.719  8.346| 22.139 21.388 16.880| 25.223 24.471 19.962| 28.409 27.608 23.045|" + LS
        + "[ 15]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 18.481 23.978 25.203| 16.873 21.855 22.401| 15.267 20.347 20.972| 13.660 19.090 20.170| 12.052 17.449 18.470| 10.444 16.231 19.147|  8.834 14.671 19.660|  7.225 13.061 18.096|  5.615  6.287  6.289|  4.530  4.390  4.390|  5.467  5.245  5.245| 18.403 13.785 13.785| 22.120 16.866 16.866| 25.198 19.949 19.949| 28.391 23.127 23.127|" + LS
        + "[ 16]G                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.225 26.062 31.292| 18.616 24.452 29.674| 17.006 22.837 27.379| 15.397 20.540 21.413| 13.790 19.626 24.838| 12.181 18.004 22.151| 10.571 15.719 16.587|  8.964 14.801 20.011|  7.355 13.191 18.415|  5.745 11.575 16.119|  4.136  3.914  4.111| 12.778 11.870  7.186| 20.889 15.642 10.269| 23.971 18.717 13.344| 27.052 21.800 16.427|" + LS
        + "[ 17]C                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.199 26.035 31.275| 18.589 24.426 29.656| 16.980 22.127 23.011| 15.373 21.203 25.746| 13.763 19.600 23.939| 12.154 16.901 17.503| 10.549 16.386 20.722|  8.940 14.776 20.004|  7.330 13.167 18.395|  5.721 10.867 11.750|  4.114  3.892  4.089| 17.106 12.534  7.168| 20.863 15.616 10.243| 23.936 18.699 13.326| 26.564 21.770 16.401|" + LS
        + "[ 18]C                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.181 26.018 31.246| 18.572 24.408 29.627| 16.962 22.792 27.337| 15.353 20.498 21.373| 13.746 19.563 23.431| 12.136 17.284 18.143| 10.529 16.366 21.564|  8.920 14.756 19.980|  7.310 13.147 18.370|  5.701 11.531 16.078|  4.092  3.870  4.067| 12.740 11.829  7.142| 20.141 15.591 10.225| 23.453 18.669 13.300| 26.525 21.282 15.909|" + LS
        + "[ 19]A                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.152 25.989 31.231| 18.543 24.379 29.612| 16.933 22.085 22.974| 15.326 21.163 26.393| 13.717 18.176 18.659| 12.114 17.951 21.839| 10.505 16.341 21.556|  8.895 14.732 19.960|  7.286 13.123 18.350|  5.677 10.826 11.712|  4.070  3.848  4.045| 16.850 12.497  7.124| 15.760 14.867 10.199| 23.405 18.181 12.808| 25.159 21.243 15.889|" + LS
        + "[ 20]A                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.137 25.973 31.210| 18.527 24.364 29.592| 16.918 22.755 27.969| 15.309 21.145 26.354| 13.699 18.440 19.039| 12.094 17.931 22.272| 10.485 16.322 21.547|  8.876 14.712 19.938|  7.266 13.102 18.281|  5.657 11.493 16.652|  4.047  3.826  4.023| 12.311 12.471  7.102| 10.706 10.478  9.707| 21.700 18.158 12.788| 20.393 19.877 15.855|" + LS
        + "[ 21]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.117 25.953 31.169| 18.508 24.344 29.550| 16.898 22.721 26.843| 15.289 21.125 24.987| 13.679 18.820 19.698| 12.072 17.909 23.117| 10.463 16.299 21.508|  8.853 14.690 19.898|  7.244 13.033 16.169|  5.635 11.471 14.246|  4.025  3.804  4.001| 12.295 12.449  7.080| 10.690 10.462  9.687| 19.105 17.764 12.765| 21.160 20.149 15.372|" + LS
        + "[ 22]G                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.075 25.912 31.124| 18.466 24.302 29.495| 16.856 21.589 22.183| 15.252 21.088 25.414| 13.642 19.479 24.705| 12.033 17.869 23.096| 10.423 16.260 21.470|  8.814 14.651 19.854|  7.205 10.913 11.234|  5.613 11.449 14.352|  4.003  3.781  3.979| 12.271 12.423  7.057| 10.668 10.447  9.666| 14.081 13.849 12.274| 17.188 15.878 10.908|" + LS
        + "[ 23]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.057 25.867 29.481| 18.448 24.284 27.576| 16.839 21.964 22.827| 15.232 21.068 26.176| 13.622 19.459 24.566| 12.013 17.849 22.991| 10.403 16.223 20.171|  8.794 14.630 18.302|  7.185 11.015 11.353|  5.590 11.426 14.469|  3.981  3.759  3.956| 11.391 11.954  7.033|  9.963 10.431  9.355|  9.039  8.808  7.809| 21.510 11.906  6.527|" + LS
        + "[ 24]G                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 20.014 24.224 24.636| 18.414 24.225 27.461| 16.805 22.608 25.560| 15.195 21.006 23.861| 13.586 19.405 22.598| 11.976 17.803 21.510| 10.367 14.926 15.445|  8.764 14.578 18.315|  7.154 11.134 11.493|  5.558 11.351 14.081|  3.948  3.737  3.934|  6.883  7.902  6.578|  5.607  5.383  5.064| 13.560  8.795  3.426| 17.332 16.228 11.381|" + LS
        + "[ 25]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 19.038 24.417 25.404| 17.430 22.638 23.390| 15.823 20.803 21.349| 14.217 19.414 20.153| 12.609 18.073 19.224| 11.001 16.837 21.838|  9.391 15.226 19.953|  7.782 13.067 13.913|  6.174 11.278 11.923|  4.567  9.317  9.722|  2.963  3.715  3.718|  1.825  2.862  2.867|  0.547  0.326  0.325|  9.196  8.283  8.282| 17.309 12.050 12.050|" + LS
        + "[ 26]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 17.653 22.793 23.671| 16.046 21.882 27.039| 14.436 15.210 15.411| 13.286 19.113 18.490| 11.676 17.439 19.950| 10.067 15.896 17.962|  8.458 14.294 17.304|  6.848 12.000 12.888|  5.241 10.392 11.279|  3.634  8.784  9.670|  2.027  7.176  8.063|  0.420  0.198  0.395| 14.091  8.847  3.474| 17.164 11.926  6.553| 19.574 14.995  9.628|" + LS
        + "[ 27]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 17.621 23.452 28.101| 16.012 21.798 24.771| 14.402 15.192 15.392| 13.243 19.051 18.397| 11.633 14.932 14.955| 10.052 15.110 14.317|  8.445 14.280 16.202|  6.835 12.671 14.544|  5.226 11.062 12.662|  3.617  9.453 14.387|  2.007  7.844 13.060|  0.398  0.176  0.373| 13.383  8.818  3.452| 16.279 11.900  6.527| 15.202 14.292  9.606|" + LS
        + "[ 28]C                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 17.583 22.844 23.856| 15.976 19.633 19.877| 14.385 15.174 15.307| 13.225 17.645 13.347| 11.620 14.990 11.438| 10.032 15.710 13.143|  8.423 14.125 11.482|  6.813 12.555  9.588|  5.204 11.040 12.631|  3.595  9.431 14.355|  1.985  7.815 12.354|  0.376  0.154  0.351|  9.023  8.112  3.426| 17.129 11.882  6.509| 20.081 14.958  9.587|" + LS
        + "[ 29]A                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     | 13.462 18.599 19.474| 11.855 14.690 14.932| 10.292 10.118 10.251| 11.734 13.446  8.355| 10.159 10.206 10.048|  9.990 13.031  8.385|  8.398 11.771  6.487|  6.789 12.530  9.557|  5.180 11.009 12.581|  3.570  9.407 13.620|  1.961  7.109  7.996|  0.354  0.132  0.329| 13.806  8.779  3.408| 16.963 11.857  6.486| 20.055 14.800  9.427|" + LS
        + "[ 30]A                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |  8.417 14.217 17.579|  6.808  9.678  9.925|  5.243  5.058  5.255|  6.935  9.833  8.150|  5.368  5.148  5.287|  9.929  8.743  3.386|  8.376 11.734  6.456|  6.767 12.508  9.532|  5.157 10.304 10.964|  3.550  9.387 14.131|  1.941  7.777 12.658|  0.332  0.110  0.307| 10.328  8.533  3.384| 16.171 11.691  6.326| 19.881 14.773  9.401|" + LS
        + "[ 31]C                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |  6.548 12.322 15.230|  4.938  9.706 10.276|  3.333  5.036  5.202|  1.879  4.847  5.060|  0.310  0.088  0.285|  7.973  7.544  3.355|  8.325 10.987  6.431|  6.745 12.418  9.464|  5.136 10.970 11.988|  3.527  9.359 11.063|  1.917  7.652  9.037|  0.308  0.088  0.284|  5.294  5.047  3.225| 11.720 10.895  6.300| 16.986 14.599  9.341|" + LS
        + "[ 32]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |  5.993  9.973 10.337|  4.396  5.062  5.219|  3.315  5.028  5.193|  1.860  4.881  5.081|  0.288  0.066  0.263|  8.409  7.881  3.334|  8.268 11.614  6.366|  6.660 10.041  8.905|  5.075 10.763  8.009|  3.466  8.871  6.346|  1.858  4.870  5.069|  0.286  0.066  0.262|  5.298  5.050  3.204| 13.668 11.478  6.241| 15.146 11.704  6.366|" + LS
        + "[ 33]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |  4.894  5.080  5.278|  4.378  5.043  5.200|  3.297  5.020  4.880|  1.840  4.918  4.842|  0.266  0.044  0.238|  8.114  8.427  3.265|  6.624  9.744  6.077|  5.042  5.080  4.912|  4.900  8.338  3.265|  3.295  5.017  4.878|  1.838  4.906  4.833|  0.264  0.044  0.238|  5.302  5.054  3.140| 10.127  8.433  3.265| 10.310  9.864  6.078|" + LS
        + "[ 34]T                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |  4.878  5.059  5.257|  4.371  5.025  2.992|  3.277  5.013  2.992|  1.812  4.960  2.992|  0.234  0.022  0.165|  3.282  5.014  2.992|  1.818  4.961  2.992|  0.240  0.022  0.165|  4.281  5.024  2.992|  3.130  5.011  2.992|  1.644  4.948  2.992|  0.061  0.021  0.165|  0.242  0.022  0.165|  5.099  5.027  2.992|  5.282  5.028  2.992|" + LS
        + "[ 35]C                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |                     |         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|         0.000  0.000|" + LS
        + "                           |G            0       |G            1       |G            2       |G            3       |G            4       |G            5       |G            6       |A            7       |T            8       |A            9       |A           10       |A           11       |A           12       |A           13       |A           14       |G           15       |G           16       |C           17       |G           18       |A           19       |C           20       |A           21       |T           22       |G           23       |C           24       |C           25       |A           26       |A           27       |T           28       |G           29       |T           30       |G           31       |T           32       |C           33       |G           34       |C           35       |C           36       |T           37       |T           38       |T           39       |T           40       |T           41       |C           42       |A           43       |A           44       |C           45       |T           46       |T           47       |T           48       |C           49       |C           50       |G           51       |A           52       |T           53       |" + LS
        ,
        score.toString());
  }

  public void testReadStartsBeforeLn() {
    final AllPaths score = score(env());
    if (score instanceof ScoreMatrixCG) {
      final ScoreMatrixCGReverse sm = (ScoreMatrixCGReverse) score;
      assertEquals(Double.NEGATIVE_INFINITY, sm.readStartsBeforeLn(-1));
      assertEquals(-23.9712, sm.readStartsBeforeLn(0), 0.0001);
      assertEquals(-22.1798, sm.readStartsBeforeLn(1), 0.0001);
      assertEquals(-20.5382, sm.readStartsBeforeLn(2), 0.0001);
      assertEquals(-18.9231, sm.readStartsBeforeLn(3), 0.0001);
      assertEquals(-17.3115, sm.readStartsBeforeLn(4), 0.0001);
      assertEquals(-15.4648, sm.readStartsBeforeLn(5), 0.0001);
      assertEquals(-14.0367, sm.readStartsBeforeLn(6), 0.0001);
      assertEquals(-4.5470, sm.readStartsBeforeLn(7), 0.0001);
      assertEquals(-4.5435, sm.readStartsBeforeLn(8), 0.0001);
      assertEquals(-2.3226, sm.readStartsBeforeLn(9), 0.0001);
      assertEquals(-0.0140, sm.readStartsBeforeLn(10), 0.0001);
      assertEquals(-0.0013, sm.readStartsBeforeLn(11), 0.0001);
      assertEquals(-0.0001, sm.readStartsBeforeLn(12), 0.0001);
      assertEquals(0.0000, sm.readStartsBeforeLn(13), 0.0001);
      assertEquals(0.0000, sm.readStartsBeforeLn(14), 0.0001);
      assertEquals(0.0, sm.readStartsBeforeLn(15));
    }
  }
}
